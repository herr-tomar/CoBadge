package ${mapperPackage};

/**
* Auto-generated mapper interface for ${protoDtoClassName}
*/

import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.factory.Mappers;
import osplus.apl.core.api.AplComponent;
import osplus.pkptuna.protobuf.util.TimestampMapper;

<#-- Import custom mapper classes -->
<#list customMapperImports as imp>
import ${imp};
</#list>

@AplComponent
@Mapper(
    uses = {
        TimestampMapper.class
        <#list customMapperSimpleNames as mapper>
        , ${mapper}.class
        </#list>
    }
)
public interface ${mapperInterfaceName} {

    ${mapperInterfaceName} INSTANCE = Mappers.getMapper(${mapperInterfaceName}.class);

    <#-- Generate @Mapping entries for repeated fields -->
    <#list repeatedFieldMappings as mapping>
    @Mapping(source = "${mapping.source}", target = "${mapping.target}")
    </#list>
    ${restDtoPackage}.${restDtoClassName} toRestDto(${protoDtoPackage}.${protoDtoClassName} proto);
}

----

List<Map<String, String>> repeatedFieldMappings = new ArrayList<>();

for (ProtoFieldModel field : model.getFields()) {
    if (field.isRepeated()) {
        Map<String, String> mapping = new HashMap<>();
        mapping.put("source", field.getName() + "List"); // e.g. eventsList
        mapping.put("target", field.getName());          // e.g. events
        repeatedFieldMappings.add(mapping);
    }
}
mapperData.put("repeatedFieldMappings", repeatedFieldMappings);
