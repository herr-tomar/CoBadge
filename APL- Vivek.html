package osplus.pkptuna.util;

import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;

/**
 * Generischer Tracker für asynchrone Antworten basierend auf Korrelations-IDs.
 *
 * @param <T> Typ des Antwortobjekts (z. B. DTO)
 */
public class GenericResponseTracker<T> {

    private final ConcurrentMap<String, CompletableFuture<T>> pending = new ConcurrentHashMap<>();

    /**
     * Registriert eine neue erwartete Antwort mit gegebener Korrelations-ID.
     */
    public void register(String correlationId) {
        pending.put(correlationId, new CompletableFuture<>());
    }

    /**
     * Markiert eine Antwort als vollständig und entfernt sie aus der Warteschlange.
     */
    public void complete(String correlationId, T response) {
        CompletableFuture<T> future = pending.remove(correlationId);
        if (future != null) {
            future.complete(response);
        }
    }

    /**
     * Gibt die `CompletableFuture` für eine bestimmte Korrelations-ID zurück.
     */
    public CompletableFuture<T> await(String correlationId) {
        return pending.get(correlationId);
    }
}
