package osplus.pkptuna.util;

import java.util.Map;
import java.util.concurrent.*;

/**
 * Zentraler, generischer Tracker für mehrere Antworttypen basierend auf Korrelations-ID und Typ.
 */
public class CentralResponseTracker {

    private final Map<String, CompletableFuture<?>> pending = new ConcurrentHashMap<>();

    /**
     * Registriert eine erwartete Antwort mit Korrelations-ID.
     */
    public <T> void register(String correlationId) {
        pending.put(correlationId, new CompletableFuture<T>());
    }

    /**
     * Markiert eine Antwort als abgeschlossen.
     */
    public <T> void complete(String correlationId, T response) {
        @SuppressWarnings("unchecked")
        CompletableFuture<T> future = (CompletableFuture<T>) pending.remove(correlationId);
        if (future != null) {
            future.complete(response);
        }
    }

    /**
     * Gibt das Future-Objekt zurück, um auf die Antwort zu warten.
     */
    @SuppressWarnings("unchecked")
    public <T> CompletableFuture<T> await(String correlationId) {
        return (CompletableFuture<T>) pending.get(correlationId);
    }
}
