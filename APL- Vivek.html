@Override
public void onMessage(Message<byte[]> message) {
    try {
        T request = handler.deserializeRequest(message.getMessageObject());
        String correlationId = handler.extractCorrelationId(request);
        String issuerId = handler.extractIssuerId(request);
        String lockKey = "route-lock-" + correlationId;

        IMap<String, String> routerMap = hazelcastInstance.getMap("router-claim-map");
        String uniqueId = UUID.randomUUID().toString();

        String existing = routerMap.putIfAbsent(lockKey, uniqueId);
        if (existing != null) {
            LOGGER.info("Skipped duplicate routing for correlationId={}", correlationId);
            return;
        }

        int index = roundRobinCounter.getAndIncrement() % partitionCount;
        String mapKey = mapBase + index;
        hazelcastInstance.getMap(mapKey).put(correlationId, request);

        LOGGER.info("ðŸ”„ Routed message with correlationId={} to {}", correlationId, mapKey);

    } catch (Exception e) {
        LOGGER.error("Routing failure: {}", e.getMessage(), e);
    }
}
