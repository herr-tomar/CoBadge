package osplus.pkptuna.flows;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import osplus.pkptuna.flows.bootstrap.HazelcastFlowConfigs;
import osplus.pkptuna.hazelcast.config.FlowConfig;

import java.util.List;
import java.util.stream.Collectors;

/**
 * Konfigurationsklasse f端r das Flows-Modul.
 * 
 * Diese Klasse aktiviert die Bindung der Hazelcast-Flow-Konfigurationen
 * und stellt ein Bean zur Verf端gung, das die Konfigurationen in das interne Modell 端berf端hrt.
 */
@Configuration
@EnableConfigurationProperties(HazelcastFlowConfigs.class)
public class FlowsModuleConfiguration {

    private static final Logger LOGGER = LoggerFactory.getLogger(FlowsModuleConfiguration.class);

    /**
     * Wandelt die extern geladenen Flow-Konfigurationen (`HazelcastFlowConfigs`) in eine Liste
     * von internen `FlowConfig`-Objekten um, die vom Hazelcast-Modul genutzt werden.
     *
     * @param external Die vom Spring-Kontext bereitgestellten Konfigurationen aus application.yml
     * @return Liste von `FlowConfig`-Objekten
     */
    @Bean
    public List<FlowConfig> hazelcastFlowConfigs(HazelcastFlowConfigs external) {
        List<FlowConfig> flowConfigList = external.flows().stream()
                .map(c -> new FlowConfig(
                        c.name(),
                        c.requestTopic(),
                        c.responseTopic(),
                        c.mapBase(),
                        c.partitions()
                ))
                .collect(Collectors.toList());

        LOGGER.info("Hazelcast-Flow-Konfigurationen geladen: {}", flowConfigList);
        return flowConfigList;
    }

}
