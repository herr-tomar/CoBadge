package osplus.pkptuna.hazelcast.flows;

import com.google.protobuf.InvalidProtocolBufferException;
import com.hazelcast.core.HazelcastInstance;

public interface FlowHandler<Req, Res> {

    Req deserializeRequest(byte[] data) throws InvalidProtocolBufferException;

    String extractCorrelationId(Req request);

    Res handleRequest(Req request);

    Object wrapResponse(String correlationId, Res result);

    void sendResponse(HazelcastInstance hazelcastInstance, String topicName, Object response );

    String getFlowName();

}

    -----

package osplus.pkptuna.hazelcast.flows;

import osplus.apl.core.api.AplComponent;

import java.util.HashMap;
import java.util.Map;

@AplComponent
public class FlowHandlerRegistry<T,R> {

    private final Map<String, FlowHandler<T, R>> handlerMap = new HashMap<>();

    public void register(String flowName, FlowHandler<T, R> handler) {
        handlerMap.put(flowName, handler);
    }

    public FlowHandler<T, R> getHandler(String flowName) {
        FlowHandler<T, R> handler = handlerMap.get(flowName);
        if (handler == null) {
            throw new IllegalArgumentException("No FlowHandler registered for flow: " + flowName);
        }
        return handler;
    }

    public boolean contains(String flowName) {
        return handlerMap.containsKey(flowName);
    }
}
