line = reader.readLine();
while (line != null) {
    line = line.trim();

    // Extract package name
    if (line.startsWith("package ")) {
        String[] parts = line.split("\\s+");
        if (parts.length >= 2) {
            packageName = parts[1].replace(";", "").trim();
        }
    }

    // Start of message
    else if (line.startsWith("message ")) {
        String messageName = line.split("\\s+")[1].replace("{", "").trim();
        currentMessage = new ProtoMessageModel(messageName);
        currentMessage.setPackageName(packageName);  // Set package name
    }

    // End of message
    else if (line.startsWith("}")) {
        if (currentMessage != null) {
            messageModels.add(currentMessage);
            currentMessage = null;
        }
    }

    // Fields inside a message
    else if (currentMessage != null && !line.isEmpty() && line.contains(";")) {
        line = line.replaceAll("^(optional|required|repeated)\\s+", "");
        String[] parts = line.split("\\s+");
        if (parts.length >= 2) {
            String type = parts[0];
            String name = parts[1];

            if (name.contains("=")) {
                name = name.substring(0, name.indexOf("=")).trim();
            }
            name = name.replace(";", "").trim();

            currentMessage.addField(new ProtoFieldModel(type, name));
        }
    }

    // Read next line
    line = reader.readLine();
}
