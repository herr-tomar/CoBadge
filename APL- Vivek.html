package osplus.pkptuna.flows;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import osplus.pkptuna.flows.bootstrap.HazelcastFlowConfigs;
import osplus.pkptuna.hazelcast.config.FlowConfig;

import java.util.List;
import java.util.stream.Collectors;

@Configuration
@EnableConfigurationProperties(HazelcastFlowConfigs.class)
public class FlowsModuleConfiguration {

    private static final Logger LOGGER = LoggerFactory.getLogger(FlowsModuleConfiguration.class);

    @Bean
    public List<FlowConfig> hazelcastFlowConfigs(HazelcastFlowConfigs external) {
        List<FlowConfig> flowConfigList = external.flows().stream()
                .map(c -> new FlowConfig(
                        c.name(),
                        c.requestTopic(),
                        c.responseTopic(),
                        c.mapBase(),
                        c.partitions()
                ))
                .collect(Collectors.toList());

        LOGGER.info("Loaded hazelcast flow configs: {}", flowConfigList);
        return flowConfigList;
    }

}
