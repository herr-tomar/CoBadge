Alles klar üëç ‚Äì ich habe die Passage zu den Response-Parametern entfernt und den gesamten Text ins Deutsche √ºbertragen.

---

# Fachliche Spezifikation ‚Äì Pr√ºfung auf bestehende Reklamation

---

## 1. Detaillierte Beschreibung des Problems

Im **bestehenden Cobadge-Verfahren** pr√ºft das System, ob bereits eine Reklamation existiert, ausschlie√ülich √ºber die **lokale Cobadge-Datenbank**. Alle Pr√ºfungen (Duplikate, Error-Retry, Zeitfenster, Konsistenz, Berechtigung) werden datenbankseitig durchgef√ºhrt.

Im **neuen Verfahren** soll die *Existenzpr√ºfung* direkt gegen das **IBO** erfolgen, das als interbankweites System of Record f√ºr Reklamationen gilt. Dadurch wird sichergestellt, dass Cobadge immer mit dem offiziellen externen Status abgeglichen ist und keine Abweichungen auftreten.

Dabei entstehen jedoch zwei wesentliche Probleme:

1. **Parameter-Mismatch**:

   * Dyns liefert transaktionsbezogene Kennungen (umsatzId, PAN, ARN usw.).
   * IBO ben√∂tigt jedoch issuerId und cardReference, um eine Reklamation nachzuschlagen.
   * Diese Parameter lassen sich nicht 1:1 abbilden.

2. **Pr√ºfungen und Validierungen**:

   * Die alte Cobadge-DB f√ºhrte zahlreiche technische und fachliche Pr√ºfungen durch.
   * Diese Pr√ºfungen sind √ºber IBO nicht abgedeckt.
   * Es muss definiert werden, wie diese Validierungen k√ºnftig umgesetzt werden.

---

## 2. Dyns Request-Parameter

Aus der Java-Implementierung werden von Dyns an Cobadge folgende Felder √ºbergeben:

* `umsatzId` ‚Üí Transaktionskennung
* `transactionLifeCycleId` ‚Üí Lebenszykluskennung der Transaktion
* `transactionDateAndTime` ‚Üí Zeitstempel der Ausf√ºhrung
* `transactionAmount` ‚Üí Betrag der Transaktion
* `primaryAccountNumber (PAN)` ‚Üí Kartennummer (bereinigt)
* `acquiringReferenceNumber (ARN)` ‚Üí Referenznummer des Acquirers

---

## 3. IBO-Parameter

Der IBO-Service zur Pr√ºfung einer bestehenden Reklamation lautet:

```
GET /api/v2/issuers/{issuerId}/cards/{cardReference}/disputes
```

### Erforderliche Eingabeparameter

* `issuerId` ‚Üí Kennung des kartenausgebenden Instituts
* `cardReference` ‚Üí Referenz auf die Karte (nicht identisch mit PAN)

---

## 4. Altes System ‚Äì Pr√ºfungen und Validierungen

Im bisherigen, rein datenbankbasierten Verfahren wurden folgende Pr√ºfungen durchgef√ºhrt:

1. **Duplikatspr√ºfung**

   * √úber UMSATZ\_ID, PAN, ARN in der Cobadge-DB.

2. **Error-Retry**

   * Bei vorherigem Fehlerstatus erneute Reklamation zul√§ssig.

3. **Zeitfenster**

   * Transaktionsdatum maximal 540 Tage alt.

4. **Konsistenz**

   * Abgleich der Werte aus JSON (PAN, ARN, Betrag, Datum/Zeit) mit UMSATZ-Tabelle.

5. **Berechtigung**

   * Feld `CBD_UMS_REKL_ZLSG_KZ` = J/N entscheidet √ºber Reklamationsf√§higkeit.

---

## 5. Neues System ‚Äì Vorgeschlagene Pr√ºfungen und Validierungen

1. **Existenzpr√ºfung**

   * Anstelle der Cobadge-DB erfolgt die Abfrage √ºber den IBO-Endpunkt `/issuers/{issuerId}/cards/{cardReference}/disputes`.
   * Ergebnis entscheidet, ob eine Reklamation extern bereits existiert.

2. **Lokale Pr√ºfungen**

   * Beibehaltung der datenbankseitigen Pr√ºfungen:

     * Duplikatspr√ºfung
     * Error-Retry
     * Zeitfenster (‚â§ 540 Tage)
     * Konsistenz
     * Berechtigung (J/N-Kennzeichen)

3. **Clearing-Anforderung**

   * Auch im neuen Verfahren muss die Cobadge-Reklamationstabelle weiterhin gef√ºllt werden, da sie f√ºr Clearing-Prozesse ben√∂tigt wird, die nicht modernisiert werden.

---

## 6. Konkrete Herausforderungen

1. **Parameter-Mismatch**

   * Dyns liefert umsatzId/ARN/PAN; IBO ben√∂tigt issuerId + cardReference.
   * Es existiert aktuell keine direkte Abbildung.

2. **Anreicherungsproblem**

   * Um cardReference aus PAN abzuleiten, sind zus√§tzliche Mapping-Daten oder Services notwendig.
   * Bisher wurde keine verl√§ssliche L√∂sung daf√ºr identifiziert.

3. **Pr√ºfungsabdeckung**

   * IBO liefert nur die Information, ob eine Reklamation existiert (√ºber Statuscodes).
   * Cobadge-spezifische Pr√ºfungen (Duplikat, Retry, Konsistenz, Berechtigung) m√ºssen weiterhin lokal erfolgen.

---

## 7. Strategien zur L√∂sung des Problems

Drei Ans√§tze sind identifiziert:

1. **Dyns anpassen**

   * Dyns so erweitern, dass `issuerId` und `cardReference` direkt geliefert werden.

2. **Neuer IBO-Service**

   * Entwicklung oder Anforderung eines IBO-API-Endpunkts, der mit Dyns-Parametern (`umsatzId`, `ARN`, `PAN`) umgehen kann und die Umwandlung intern vornimmt.

3. **Anreicherung in Cobadge**

   * Dyns und IBO unver√§ndert lassen.
   * In Cobadge eine √úbersetzungs-/Anreicherungsschicht aufbauen, die:

     * `PAN ‚Üí cardReference` abbildet,
     * `issuerId` ggf. aus DB ableitet,
     * weitere Parameter normalisiert,
   * und anschlie√üend den IBO-Service mit den angereicherten Werten aufruft.

---

Soll ich dir dazu auch eine **Mapping-Tabelle Dyns-Parameter ‚Üî IBO-Parameter** erg√§nzen, sodass im Dokument auf einen Blick erkennbar ist, wo die L√ºcken liegen?
