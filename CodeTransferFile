@Test
public void testNotLeaderDoesNotSubscribeToTopics() {
    // Simulate another instance as the leader BEFORE router starts
    long now = System.currentTimeMillis();
    heartbeatMap.put("heartbeat", now);
    leaderMap.put("active-router", "another-instance");

    router.setRouterInstanceId("test-router-instance");

    // Now initRouters() should detect another leader and skip subscription
    router.initRouters();

    topic.publish("{\"key\":\"value\"}".getBytes());

    await().during(300, MILLISECONDS)
           .atMost(1, SECONDS)
           .untilAsserted(() ->
               assertFalse(testCollector.wasSent("res-topic"), "Non-leader router should not route or respond")
           );
}
