@Test
public void testMessageRoutedSuccessfully() {
    // Clear maps to simulate a clean state
    leaderMap.clear();
    heartbeatMap.clear();

    // Allow this test router to claim leadership
    router.setRouterInstanceId(routerInstanceId);
    router.initRouters();

    topic.publish("{\"key\":\"value\"}".getBytes());

    await().atMost(2, SECONDS) // Increase timeout for slow environments
           .until(() -> testCollector.wasSent("res-topic"));

    assertEquals("wrappedResponse", testCollector.getSent("res-topic"));
}
