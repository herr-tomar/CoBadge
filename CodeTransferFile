import static org.awaitility.Awaitility.await;
import static java.util.concurrent.TimeUnit.MILLISECONDS;

@Test
public void testNotLeaderDoesNotSubscribeToTopics() throws Exception {
    testCollector.clear();

    long now = System.currentTimeMillis();
    heartbeatMap.put("heartbeat", now);
    leaderMap.put("active-router", "another-instance"); // simulate another leader

    // ðŸ•’ Wait until the router sees the simulated state
    await().atMost(500, MILLISECONDS).until(() ->
        heartbeatMap.get("heartbeat") != null &&
        "another-instance".equals(leaderMap.get("active-router"))
    );

    router.setRouterInstanceId("test-router-instance");
    router.initRouters();

    String topicName = flowConfig.requestTopic();
    topic = hazelcastInstance.getReliableTopic(topicName);
    topic.publish("{\"key\":\"value\"}".getBytes());

    // ðŸ•’ Wait briefly to ensure no listener was attached
    Thread.sleep(300);

    // âœ… Validate that message was NOT routed
    assertFalse(testCollector.wasSent("res-topic"), "Non-leader router should not route or respond");
}
