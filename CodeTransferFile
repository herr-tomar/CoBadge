private volatile boolean isLeader = false;
private void tryBecomeLeaderIfStale() {
    if (isLeader) return; // No need to re-elect if we're already the leader

    try {
        IMap<String, String> leaderMap = hazelcastInstance.getMap("router-leader-map");
        IMap<String, Long> heartbeatMap = hazelcastInstance.getMap("router-heartbeat-map");

        String currentLeader = leaderMap.get("active-router");
        Long lastHeartbeat = heartbeatMap.get("heartbeat");

        boolean heartbeatStale = (lastHeartbeat == null || System.currentTimeMillis() - lastHeartbeat > 5000);

        if (heartbeatStale) {
            String previous = leaderMap.put("active-router", routerInstanceId);

            if (previous == null || previous.equals(currentLeader)) {
                LOGGER.info("This node is elected as the ACTIVE router (ID={})", routerInstanceId);
                isLeader = true;
                startHeartbeat();
                subscribeToTopics();
            } else {
                LOGGER.info("Another node claimed leadership before us (ID={})", previous);
                unsubscribeFromTopics();
            }
        } else {
            LOGGER.info("Leadership exists and heartbeat is alive (Leader={}, LastBeat={})",
                    currentLeader, lastHeartbeat);
            unsubscribeFromTopics();
        }
    } catch (Exception e) {
        LOGGER.error("Failed to check or claim leadership", e);
    }
}
public void shutdown() {
    unsubscribeFromTopics();
    scheduler.shutdownNow();
    isLeader = false;
}
