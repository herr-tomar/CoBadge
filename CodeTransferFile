@Test
public void testNotLeaderDoesNotSubscribeToTopics() throws Exception {
    testCollector.clear();

    // Force heartbeat and another active leader BEFORE initRouters
    long now = System.currentTimeMillis();
    IMap<String, Long> heartbeatMap = hazelcastInstance.getMap("router-heartbeat-map");
    IMap<String, String> leaderMap = hazelcastInstance.getMap("router-leader-map");

    heartbeatMap.put("heartbeat", now);
    leaderMap.put("active-router", "another-instance");

    // Now initialize the router – it should detect that it is NOT the leader
    router.setRouterInstanceId("test-router-instance");
    router.initRouters();

    // Publish message to topic; router should NOT receive it
    ITopic<byte[]> topic = hazelcastInstance.getReliableTopic(flowConfig.requestTopic());
    topic.publish("{\"key\":\"value\"}".getBytes());

    // Give some time for message propagation
    Thread.sleep(500);

    // ✅ Assert that nothing was sent
    assertFalse(testCollector.wasSent("res-topic"), "Non-leader router should not route or respond");
}
