@TestConfiguration
static class FaultyHandlerTestConfig {

    @Bean
    public FlowHandler<DummyMessage, DummyMessage, DummyMessage> faultyHandler() {
        FlowHandler<DummyMessage, DummyMessage, DummyMessage> handler = mock(FlowHandler.class);
        when(handler.getFlowName()).thenReturn("myFlow");
        when(handler.deserializeRequest(any())).thenReturn(new DummyMessage());
        when(handler.extractCorrelationId(any())).thenReturn("id123");
        when(handler.handleRequest(any())).thenThrow(new RuntimeException("boom!"));
        return handler;
    }

    @Bean
    public Map<String, FlowHandler> handlerMap(FlowHandler<DummyMessage, DummyMessage, DummyMessage> faultyHandler) {
        return Map.of("myFlow", faultyHandler);
    }
}
