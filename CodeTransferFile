@Test
    public void testMessageRoutedSuccessfully() throws Exception {
        // Clear maps and allow router to become leader
        leaderMap.clear();
        heartbeatMap.clear();

        router.setRouterInstanceId(routerInstanceId);
        router.initRouters();

        // Prepare a valid request
        Map<String, Object> request = Map.of("key", "value");
        String corrId = sampleFlowHandler.extractCorrelationId(request);
        topic.publish(new ObjectMapper().writeValueAsBytes(request));

        await()
                .atMost(200, TimeUnit.SECONDS)
                .pollInterval(50, TimeUnit.MILLISECONDS)
                .untilAsserted(() -> {
                    assertTrue(testCollector.wasSent(flowConfig.responseTopic()), "Expected message to be routed and response sent");
                    assertEquals("wrappedResponse", testCollector.getSent(flowConfig.responseTopic()));
                });
    }
